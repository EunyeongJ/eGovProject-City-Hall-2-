<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardMapper">

	<!-- 대분류 뽑아오기 -->
	<select id="getCommonGroupCode" resultType="com.mvc.dao.CommonCodeDTO">
		SELECT group_cd, cd, cdnm, use_yn, sn
		FROM CMMN_CD
		WHERE group_cd = 'ad01'
	</select>
	
	<!-- 결제방법 분류 뽑아오기 -->
	<select id="getApprCommonGroupCode" resultType="com.mvc.dao.CommonCodeDTO">
		SELECT group_cd, cd, cdnm, use_yn, sn
		FROM CMMN_CD
		WHERE group_cd = 'ad02'
	</select>
	
	<!-- 선택한 대분류가 변하는 것을 체크하여 중분류를 가져간다. -->
	<select id="selectChangeCheck" parameterType="String" resultType="com.mvc.dao.CommonCodeDTO">
		SELECT group_cd, cd, cdnm, use_yn, sn
		FROM CMMN_CD
		WHERE group_cd = #{groupCodeCD}
	</select>
	
	<!-- 게시판에 먼저 insert를 하고 양식들은 다른 테이블에 저장 -->
	<insert id="insertBoard" parameterType="com.mvc.dao.ApprBoardDTO">
		<selectKey keyProperty="doc_num" resultType="int" order="BEFORE">
			SELECT LAST_INSERT_ID() <!-- 자동증가값의 현재값이 얼마냐 -->
		</selectKey>
		INSERT INTO apprBoard(doc_title, mber_num, doc_group, doc_step, doc_indent, reg_id)
		VALUES (#{doc_title}, #{mber_num}, #{doc_num}, 1, 0, #{mber_id});
	</insert>
	
	<!-- 양식 insert -->
	<insert id="insertForm" parameterType="com.mvc.dao.ApprBoardDTO">
		<selectKey keyProperty="doc_num" resultType="int" order="BEFORE">
			SELECT LAST_INSERT_ID() <!-- 자동증가값의 현재값이 얼마냐 -->
		</selectKey>
		INSERT INTO apprHis(doc_num, group_cd, cd, sp_div, sp_date, sp_cont, sp_pay, reg_id)
		VALUES (#{doc_num}, #{group_cd}, #{cd}, #{sp_div}, #{sp_date}, #{sp_cont}, #{sp_pay}, #{mber_id})
	</insert>
	
	<!-- List 가져오기 -->
	<select id="getBoardList" resultType="com.mvc.dao.BoardDTO">
		select * FROM apprBoard ORDER BY doc_num desc
	</select>

</mapper>